---
title: C5045 d’avertissement du compilateur
ms.date: 06/21/2018
helpviewer_keywords:
- C5045
ms.openlocfilehash: da97c4e01f85b18ff79132f9365bf9bd282c89ce
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "62152512"
---
# <a name="compiler-warning-c5045"></a>C5045 d’avertissement du compilateur

> Compilateur va insérer l’atténuation de Spectre pour la charge de mémoire si le commutateur/qspectre spécifié

## <a name="remarks"></a>Notes

Avertissement C5045 permet de vous voir les modèles dans votre code provoquent une atténuation de Spectre, par exemple un LFENCE, doit être inséré lorsque la [/qspectre](../../build/reference/qspectre.md) option du compilateur est spécifiée. Cela vous permet d’identifier les fichiers de code sont affectés par le problème de sécurité. Cet avertissement est purement informatif : l’atténuation n’est pas insérée jusqu'à ce que vous recompilez à l’aide de la **/qspectre** basculer. La fonctionnalité de C5045 est indépendante de la **/qspectre** commutateur, vous pouvez les utiliser à la fois dans la même compilation.

Cet avertissement est une nouveauté de Visual Studio 2017 version 15.7 et est désactivée par défaut. Utilisez [/Wall](../../build/reference/compiler-option-warning-level.md) pour activer tous les avertissements qui sont désactivés par défaut, ou __/w__*n*__5038__ pour activer C5045 en tant que niveau *n* avertissement. Dans l’IDE, le niveau d’avertissement par défaut est **w3** et cet avertissement peut être activé dans le projet **Pages de propriétés** boîte de dialogue. Ouvrez **propriétés de Configuration** > **C/C++** > **ligne de commande** et dans le **des options supplémentaires** zone, ajoutez */w35045*, puis choisissez **OK**. Pour plus d’informations, consultez [avertissements du compilateur désactivés par défaut](../../preprocessor/compiler-warnings-that-are-off-by-default.md). Pour plus d’informations sur la désactivation des avertissements par version du compilateur, consultez [avertissements du compilateur par version du compilateur](compiler-warnings-by-compiler-version.md).

## <a name="example"></a>Exemple

L’exemple suivant génère l’avertissement C5045 lors de la compilation par Visual Studio 2017 version 15.7 avec le **/Wall** ou **/w35045** et **w3** options :

```cpp
// C5045.cpp
// Compile with: cl /EHsc /W3 /w35045 C5045.cpp

int G, G1, G2;

__forceinline
int * bar(int **p, int i)
{
    return p[i];
}

__forceinline
void bar1(int ** p, int i)
{
    if (i < G1) {
        auto x = p[i]; // C5045: mitigation here
        G = *x;
    }
}

__forceinline
void foo(int * p)
{
    G = *p;
}

void baz(int ** p, int i)
{
    if (i < G1) {
        foo(bar(p, i + G2));
    }
    bar1(p, i);
}

int main() { }
```

La sortie du compilateur lors de l’avertissement est activé ressemble à ceci :

```Output
C:\Users\username\source\repos\C5045>cl /W3 /w35045 C5045.cpp
Microsoft (R) C/C++ Optimizing Compiler Version 19.14.26431 for x86
Copyright (C) Microsoft Corporation.  All rights reserved.

C5045.cpp
c:\users\username\source\repos\c5045\c5045.cpp(16) : warning C5045: Compiler will insert Spectre mitigation for memory load if /Qspectre switch specified
c:\users\username\source\repos\c5045\c5045.cpp(15) : note: index 'i' range checked by comparison on this line
c:\users\username\source\repos\c5045\c5045.cpp(17) : note: feeds memory load on this line
Microsoft (R) Incremental Linker Version 14.14.26431.0
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:C5045.exe
C5045.obj
```

Les messages d’avertissement indiquent qu’une atténuation aurait été insérée sur la ligne 16. Il indique également que l’atténuation est nécessaire, car l’index i sur la ligne 15 flux de la charge de mémoire sur la ligne 17. La spéculation est effectuée parmi barre et bar1 mais l’atténuation est efficace lorsqu’il est placé à la ligne 16.

## <a name="see-also"></a>Voir aussi

[Guide pour les développeurs de C++ sur les canaux auxiliaires d’exécution spéculative](../../security/developer-guidance-speculative-execution.md)<br/>
[/Qspectre](../../build/reference/qspectre.md)<br/>
[spectre](../../cpp/spectre.md)
